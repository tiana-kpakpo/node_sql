<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Employee Details</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="./register.css">
</head>

<body>


    <div class="wrapper">

        <!-- ----- left ------ -->
        <div class="authentication">
            <form action="#" id="edit-form">
                <div class="brand">
                    <img src="./img/logo.png" alt="logo">
                </div>
                <div class="error">
                    <span class="error-message"> </span>
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <label for="name"></label>
                        <input type="text" name="name" id="name" placeholder="edit employee name">
                        <label for="email"></label>
                        <input type="email" name="email" id="email" placeholder="edit employee email">
                        <label for="job_title"></label>
                        <input type="text" name="job_title" id="job_title" placeholder="edit employee role">

                    </div>
                    <div class="input-group">
                        <a href="./dashboard.html"><button type="submit" id="scBtn">Save Changes</button></a>
                    </div>
                </div>

            </form>
        </div>
        <!-- ----- right------ -->
        <div class="wallpaper"> </div>

    </div>

    <script>

    const urlParams = new URLSearchParams(window.location.search);
    const employeeId = urlParams.get('id');
    
    const nameInput = document.querySelector('#name')
    const emailInput = document.querySelector('#email')
    const jobInput = document.querySelector('#job_title')
    const btn = document.querySelector('#scBtn')
    
    async function fetchEmployeeData() {
        const url = `http://localhost:7070/api/employee/${employeeId}`;
    console.log('Fetching data from:', url);
    
        try {
            const response = await fetch(url);
            if (!response.ok) {
            throw new Error(`Error fetching employee data: ${response.statusText}`);
        }
            const data = await response.json();
    
            jobInput.value = data.job_title;
            nameInput.value = data.name;
            emailInput.value = data.email;

            console.log(data)

        } catch (error) {
            console.error('Error fetching employee data:', error);
        }
    }
    
    fetchEmployeeData();
    
    btn.addEventListener('click', async event => {
        event.preventDefault();
    
        const updateUrl = `http://localhost:7070/api/employee/${employeeId}`; 
      
    
        try {
            const response = await fetch(updateUrl, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: nameInput.value,
                    email: emailInput.value,
                    job_title: jobInput.value
                })
            });
            
    
            const result = await response.json();
            console.log('Update response:', result);
    
            const employeeConfirmed = confirm(`Are you sure you want to update employee ${employeeId}`);
    
            if (!employeeConfirmed) {
                return; // Do nothing if the user cancels the confirmation
            } else {
                window.location.href = './dashboard.html?refresh=true';
            }
        } catch (error) {
            console.error('Error updating employee data:', error);
        }
    });
    

</script>
</body>

</html>